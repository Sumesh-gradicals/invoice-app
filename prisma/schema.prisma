generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Customer {
  id            String            @id @default(cuid())
  name          String
  email         String
  address       String?
  phone         String?
  location      String?
  lastVisited   String?           @default("Never")
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  notes         String?
  attachmentUrl String?
  signatureUrl  String?
  projects      ProjectCustomer[]
  invoices      Invoice[]
}

model Project {
  id             String            @id @default(cuid())
  name           String
  phase          String            // Inquiry, Proposal, Booked, In progress, Complete
  date           String?
  description    String?
  estimatedValue Float?
  winConfidence  String?
  createdAt      DateTime          @default(now())
  lastActivity   DateTime          @default(now())
  customers      ProjectCustomer[]
  invoices       Invoice[]
}

model ProjectCustomer {
  projectId  String
  customerId String
  isPrimary  Boolean  @default(false)
  project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@id([projectId, customerId])
}

model Invoice {
  id         String        @id @default(cuid())
  invoiceId  String        // The readable ID e.g. 000001
  title      String
  subtotal   Float
  total      Float
  status     String        // Draft, Paid, Overdue, Sent
  date       String
  createdAt  DateTime      @default(now())
  sentAt     DateTime?
  customerId String
  customer   Customer      @relation(fields: [customerId], references: [id])
  projectId  String?
  project    Project?      @relation(fields: [projectId], references: [id])
  items      InvoiceItem[]
}

model InvoiceItem {
  id        String  @id @default(cuid())
  name      String
  qty       Int
  price     Float
  invoiceId String
  invoice   Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
}

model Profile {
  id        String   @id // This will be the Supabase user ID
  email     String   @unique
  role      String   @default("Ops") // Admin or Ops
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
